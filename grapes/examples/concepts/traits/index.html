<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GrapesJS concepts of Traits</title>
    <!-- GrapesJS CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/grapesjs/dist/css/grapes.min.css"
    />
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
      }

      .header {
        background-color: #333;
        color: white;
        padding: 10px 20px;
        text-align: center;
        font-size: 18px;
        font-weight: bold;
      }

      .instructions {
        background-color: #f8f9fa;
        padding: 15px;
        border-bottom: 1px solid #ddd;
        font-size: 14px;
        color: #666;
      }
    </style>
  </head>
  <body>
    <div class="header">GrapesJS concepts of Traits</div>

    <div class="instructions">
      <strong>说明：</strong>
      这是一个 GrapesJS 组件概念演示。你可以在画布中拖拽、编辑和删除组件。
      双击文本可以编辑内容，选中元素可以在右侧面板中修改样式。
      <br>
      <br>
      <strong>下面示例展示了如何在 GrapesJS 组件中管理特性。用户通常会将特性视为”设置“。所有组件默认包含两个特性： id 和 title：</strong>
      <a href="https://grapesjs.com/docs/modules/Traits.html#trait-manager">文档</a>
      <br>
      <br>
      <strong>内置特性类型：</strong>
      <a href="https://grapesjs.com/docs/modules/Traits.html#built-in-trait-types">文档</a>
      <br>
      <br>
      <strong>在运行时更新特性：</strong>
      <a href="https://grapesjs.com/docs/modules/Traits.html#updating-traits-at-run-time">文档</a>
      <br>
      <br>
      <strong>国际化（i18n）：</strong>
      <a href="https://grapesjs.com/docs/modules/Traits.html#i18n">文档</a>
    </div>

    <!-- GrapesJS 编辑器容器 -->
    <div id="gjs"></div>

    <!-- GrapesJS JavaScript -->
    <script src="https://unpkg.com/grapesjs"></script>
    <script>
      // 初始化 GrapesJS 编辑器 - 使用最简配置
      const editor = grapesjs.init({
        container: "#gjs",
        // 禁用存储管理器
        storageManager: false,
      });

      // 定义特性分组
      const category1 = { id: 'first', label: 'First category' };
      const category2 = { id: 'second', label: 'Second category', open: false };

      // 自定义 input 组件
      editor.Components.addType('input', {
        isComponent: (el) => el.tagName === 'INPUT',
        model: {
          defaults: {
            traits: [
              // 字符串会自动转换为文本类型
              // 'name', // 等同于: { type: 'text', name: 'name' }
              {
                name: 'name',
                category: category1,
              },
              // 默认情况下，traits会修改模型的属性，但您也可以通过使用changeProp选项将它们绑定到属性。
              {
                name: 'placeholder',
                changeProp: 1,
                category: category2,
              },
              {
                // 内置类型包括：https://grapesjs.com/docs/modules/Traits.html#built-in-trait-types
                type: 'select', // 特性类型
                name: 'type', //（必需）用于组件的属性/特性名称
                label: 'Type', // 在设置面板中显示的标签
                options: [
                  { id: 'text', label: 'Text' },
                  { id: 'email', label: 'Email' },
                  { id: 'password', label: 'Password' },
                  { id: 'number', label: 'Number' },
                ],
                category: category2,
              },
              {
                type: 'checkbox',
                name: 'required',
                category: category2,
              },
            ],
            // 默认情况下，特性绑定到属性，因此可通过 attributes 定义初始值
            attributes: { type: 'text', required: true },
            // 定义 placeholder 的初始值
            placeholder: 'Initial placeholder',
          },
          init() {
            // 如果您需要对某个属性的变化做出反应，您可以订阅它们的属性监听器。
            this.on('change:attributes:type', this.handleTypeChange);
            // 监听 placeholder 变化
            this.on('change:placeholder', this.handlePlhChange);
          },
          handleTypeChange() {
            console.log('Input type changed to: ', this.getAttributes().type);
          },
          handlePlhChange() {
            console.log('Placeholder changed to: ', this.get('placeholder'));
          },
        },
      });

      // 如果您愿意，您还可以通过函数动态地定义特性，这些特性将在组件初始化时创建。如果您需要根据其他组件特征来创建特性，这可能会有所帮助。
      editor.Components.addType('a', {
        isComponent: (el) => el.tagName === 'A',
        model: {
          defaults: {
            traits(component) {
              const result = [];

              // Example of some logic
              if (component.get('draggable')) {
                result.push('href');
              } else {
                result.push({
                  type: 'title',
                });
              }

              return result;
            },
          },
        }
      });

      const components = editor.addComponents([
        `
          <input>
          <a>link</a>
        `
      ]);
    </script>
  </body>
</html>
